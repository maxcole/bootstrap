---
- name: Bootstrap home lab machine
  hosts: localhost
  connection: local
  
  tasks:
    - name: Install rbenv and latest ruby
      include_role:
        name: rbenv
      tags: [never]
        
    - name: Check if para config needs stowing
      command: stow -n -d /home/ansible/bootstrap -t /home/ansible para
      register: stow_check
      failed_when: false
      changed_when: false
      tags: [never]

    - name: Stow para config
      # GNU stow syntax: -d for source directory, -t for target, and para as the package
      command: stow -d /home/ansible/bootstrap -t /home/ansible para
      # when: stow_check.rc != 0
      
    - name: Check para command availability
      shell: command -v para
      register: para_check
      ignore_errors: yes
      
    - name: Display para check result
      debug:
        msg: "Para command {{ 'available' if para_check.rc == 0 else 'not available' }} at {{ para_check.stdout if para_check.rc == 0 else 'not found' }}"
